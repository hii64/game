<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<title>オセロゲーム（リバーシ）</title>
<style>
  body { font-family: Arial, sans-serif; text-align: center; }
  table { border-collapse: collapse; margin: 20px auto; }
  td {
    width: 40px; height: 40px;
    border: 1px solid #333;
    background-color: green;
    cursor: pointer;
    position: relative;
  }
  .black, .white {
    border-radius: 50%;
    width: 32px; height: 32px;
    margin: 3px auto;
  }
  .black { background-color: black; }
  .white { background-color: white; }
  #message { font-size: 1.2em; margin: 10px; }
  #passBtn {
    margin-top: 10px;
    padding: 5px 10px;
    font-size: 1em;
  }
</style>
</head>
<body>

<h1>オセロゲーム（リバーシ）</h1>
<div id="message">黒のターンです</div>
<table id="board"></table>
<button id="passBtn" onclick="passTurn()">パス</button>

<script>
  const BOARD_SIZE = 8;
  const EMPTY = 0, BLACK = 1, WHITE = 2;
  let board = [];
  let currentPlayer = BLACK;

  const directions = [
    [-1, -1], [-1, 0], [-1, 1],
    [0, -1],           [0, 1],
    [1, -1],  [1, 0],  [1, 1]
  ];

  const boardElem = document.getElementById('board');
  const messageElem = document.getElementById('message');
  const passBtn = document.getElementById('passBtn');

  function initBoard() {
    board = Array.from({length: BOARD_SIZE}, () => Array(BOARD_SIZE).fill(EMPTY));
    board[3][3] = WHITE;
    board[3][4] = BLACK;
    board[4][3] = BLACK;
    board[4][4] = WHITE;
  }

  function createBoard() {
    boardElem.innerHTML = '';
    for (let x=0; x<BOARD_SIZE; x++) {
      const row = document.createElement('tr');
      for (let y=0; y<BOARD_SIZE; y++) {
        const cell = document.createElement('td');
        cell.dataset.x = x;
        cell.dataset.y = y;
        cell.addEventListener('click', () => handleClick(x,y));
        row.appendChild(cell);
      }
      boardElem.appendChild(row);
    }
    updateBoard();
  }

  function updateBoard() {
    for (let x=0; x<BOARD_SIZE; x++) {
      for (let y=0; y<BOARD_SIZE; y++) {
        const cell = boardElem.rows[x].cells[y];
        cell.innerHTML = '';
        if (board[x][y] === BLACK) {
          const disc = document.createElement('div');
          disc.className = 'black';
          cell.appendChild(disc);
        } else if (board[x][y] === WHITE) {
          const disc = document.createElement('div');
          disc.className = 'white';
          cell.appendChild(disc);
        }
      }
    }
    if (isGameOver()) {
      const [blackCount, whiteCount] = countDiscs();
      if (blackCount > whiteCount) {
        messageElem.textContent = `ゲーム終了！黒の勝ちです！ B:${blackCount} W:${whiteCount}`;
      } else if (whiteCount > blackCount) {
        messageElem.textContent = `ゲーム終了！白の勝ちです！ B:${blackCount} W:${whiteCount}`;
      } else {
        messageElem.textContent = `ゲーム終了！引き分けです！ B:${blackCount} W:${whiteCount}`;
      }
      passBtn.disabled = true;
    } else {
      messageElem.textContent = (currentPlayer === BLACK ? '黒' : '白') + 'のターンです';
      passBtn.disabled = validMoves(currentPlayer).length > 0 ? false : true;
    }
  }

  function onBoard(x,y) {
    return x>=0 && x<BOARD_SIZE && y>=0 && y<BOARD_SIZE;
  }

  function opponent(player) {
    return player === BLACK ? WHITE : BLACK;
  }

  function wouldFlip(x, y, player) {
    if (board[x][y] !== EMPTY) return [];
    let flips = [];
    for (const [dx, dy] of directions) {
      let nx = x + dx, ny = y + dy;
      let tempFlips = [];
      while (onBoard(nx, ny) && board[nx][ny] === opponent(player)) {
        tempFlips.push([nx, ny]);
        nx += dx;
        ny += dy;
      }
      if (onBoard(nx, ny) && board[nx][ny] === player && tempFlips.length > 0) {
        flips = flips.concat(tempFlips);
      }
    }
    return flips;
  }

  function validMoves(player) {
    let moves = [];
    for (let x=0; x<BOARD_SIZE; x++) {
      for (let y=0; y<BOARD_SIZE; y++) {
        if (wouldFlip(x,y,player).length > 0) moves.push([x,y]);
      }
    }
    return moves;
  }

  function makeMove(x,y,player) {
    let flips = wouldFlip(x,y,player);
    if (flips.length === 0) return false;
    board[x][y] = player;
    for (const [fx, fy] of flips) {
      board[fx][fy] = player;
    }
    return true;
  }

  function countDiscs() {
    let blackCount = 0, whiteCount = 0;
    for (let x=0; x<BOARD_SIZE; x++) {
      for (let y=0; y<BOARD_SIZE; y++) {
        if (board[x][y] === BLACK) blackCount++;
        else if (board[x][y] === WHITE) whiteCount++;
      }
    }
    return [blackCount, whiteCount];
  }

  function isGameOver() {
    return validMoves(BLACK).length === 0 && validMoves(WHITE).length === 0;
  }

  function handleClick(x,y) {
    if (makeMove(x,y,currentPlayer)) {
      currentPlayer = opponent(currentPlayer);
      if (validMoves(currentPlayer).length === 0) {
        alert((currentPlayer === BLACK ? '黒' : '白') + 'は置ける場所がありません。パスします。');
        currentPlayer = opponent(currentPlayer);
        if (validMoves(currentPlayer).length === 0) {
          // ゲーム終了
          updateBoard();
          return;
        }
      }
      updateBoard();
    } else {
      alert("そこには置けません。");
    }
  }

  function passTurn() {
    if (validMoves(currentPlayer).length === 0) {
      currentPlayer = opponent(currentPlayer);
      alert((currentPlayer === BLACK ? '黒' : '白') + 'のターンになりました。');
      updateBoard();
    } else {
      alert("置ける場所があるのでパスできません。");
    }
  }

  // 初期化
  initBoard();
  createBoard();
  updateBoard();
</script>

</body>
</html>
